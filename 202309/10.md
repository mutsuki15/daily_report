# 2023/9/10 日報
## 取り組んだ課題一覧
- REST WebAPI サービス 設計 | Udemy

## わかったこと
- URI設計で考慮すること
  - 冗長なパスを含まない短いものにする
  - 人が読んで理解できるようできるだけ省略しない
  - 全て小文字で書く
  - 単語はハイフンで繋げる(_はNG)
  - 単語は複数形にする
  - エンコードを必要とする文字を使わない
  - サーバー側のアーキテクチャを反映しない
  - 一定のルールに統一する
- リソースを特定するパラメータ
  - クエリパラメータ
    URLの末尾にある"?"に続くキーバリュー。一位なリソースを表すのに必要な時に使用。
  - パスパラメータ
    URL中に埋め込まれるパラメータ。省略かのな場合に使用。
- ステータスコードの意味
  - 100番台
    情報
    - 100 Continue
      サーバーがリクエストの最初の部分を受け取り、まだサーバーから拒否されていないことを示す。
    - 101 Switching Protocol
      プロトコルの切り替え要求を示す。
  - 200番台
    成功
    - 200 OK
      リクエストが成功したことを示す。本文中にデータが含まれる。
    - 201 Created
      リクエストが成功し、新しいリソースが作成されたことを示す。ヘッダーのLocationに新しいリソースのURLを含める。
    - 202 Accepted
      非同期ジョブを受け付けたことを示す。実際の処理結果は別途受け取る。
    - 204 No Content
      リクエストは成功したが、レスポンスデータがないことを示す。クライアント例のビューを変更する必要がないことを意味する。
  - 300番台
    リダイレクト(API利用者はリダイレクトを実装していないことが多いので、REST APIでは基本的に300番台は利用しない)
  - 400番台
    クライアントサイドに起因するエラー
    - 400 Bad Request
      その他エラー(クライアント側のリクエストの内容に不備がある)
    - 401 Unauthorized
      認証されていないことを示す。
    - 403 Fobidden
      リソースに対するアクセスが許可されていないことを示す。
    - 404 Not Found
      リクエストされたリソースが存在しないことを示す。
    - 409 Conflict
      リソースが競合して処理が完了できなかったことを示す。
    - 429 Too Many Requests
      アクセス回数が制限回数(レートリミット)を超えたため処理できなかったことを示す。
  - 500番台
    サーバーサイドに起因するエラー
    - 500 Internal Server Error
      サーバーサイドのアプリケーションエラーが発生したことを示す。
    - 503 Service Unavailable
      サービスが一時的に利用できないことを示す。メンテナンス期間や過負荷で応答できないようなケース。
- 主要なレスポンスデータフォーマット
  - XML
    - テキスト形式
    - タグで記述
    - タグは入れ子にできる
    - タグに属性がつけられる
  - JSON
    - テキスト形式
    - JavaScriptをもとにしたフォーマット
    - XMLに比べてデータ量が減らせる
    - オブジェクトは入れ子にできる
  - JOSNP
    - テキスト形式
    - データフォーマットに見えるが、JavaScriptコードである
    - クロスドメインでデータを受け渡しができる
- データフォーマットの指定方法
  - クエリパラメータに記載
  - 拡張子に記載
  - リクエストヘッダーに記載
- データ内部構造の設計で考慮すること
  - エンベロープ(レスポンスボディ内のメタ情報)は使わない
  - オブジェクトはできるだけフラットする
  - ページネーションをサポートする情報を返す
  - プロパティの命令規則はAPI全体で統一する
  - 日付はRFC3339(W3C-DTF)形式を使う
  - 大きな数値(64bit整数)は文字列で返す
- エラー表現で考慮すること
  - エラー詳細はレスポンスボディに入れる
  - エラーの際にHTMLが返らないようにする
  - サービス閉塞時は"503"+"Retry-After"で返す
- 認証は「本人特定」、認可は「アクセスの制御」の意味
- OAuth
  - 複数のWebサービスを連携して動作させるために使われる仕組み
- OpenID Connect
  - OAuthに本人情報取得を加えたもの
- JSON Web Torken
  JSON形式で表現された認証情報などを標準化したもの
- レートリミット
  時間あたりのアクセス制限をかけること
- レートリミットアルゴリズム
  - Fixed Window
    指定時間枠でリクエスト回数の上限をつける仕組み
  - Sliding Log
    過去○分間のリクエスト回数に上限をつける仕組み
  - Sliding Window
    過去○分間のリクエスト回数の比率に上限をつける仕組み
- キャッシュ制御に使うヘッダー
  - Expires
    - キャッシュとしているまで利用可能かの期限を指定する
    - 過去日を指定するとリソースの有効期限切れであることを意味する
    - Cache-Controlが同時指定されている場合、Expiresは無視する
  - Cache-Control+Date
    - Cache-Controlでキャッシュの可否、期限を指定する
  - Last-Modified+ETag
    - Last-Modifiedにリソースの最終更新日時を指定する
    - ETagに特定バージョンを示す文字列を指定する
- APIのセキュリティ対策
  - XSS
    悪意あるユーザーが正規のサイトに不正なスクリプトを挿入することで、正規ユーザーの情報を不正に引き出したり操作できてしまう問題
    - 対策
      - レスポンスヘッダーの追加
        - X-XSS-Protection
          "1"でXSSフィルタリング有効化
        - X-Frame-Options
          "DENY"でframeタグ呼び出しを拒否
        - X-Content-Type-Options
          "nosniff"でIE脆弱性対応
  - CSRF
    本来拒否しなければならないアクセス元(トラップサイト)から来るリクエストを処理してしまう問題
    - 対策
      - 許可しないアクセス元からのリクエストを拒否
        - X-API-Key
          システム単位で実行可否判断
        - Authentication
          ユーザー単位で実行可否判断
      - 攻撃者に推測されにくいトークンの発行/商号処理を実装
        - X-CSRF-TOKEN
          トークンを使って実行可否判断
  - HTTP
    通信経路が暗号化されないので盗聴されやすい
    - 対策
      - 常時HTTPSを利用した通信にする
        - SSL/TLS/HTTPSの違い
          - SSL
            安全に通信を行うためのプロトコル(2015年に使用禁止)
          - TLS
            SSLの後継
          - HTTPS
            HTTP+SSL/TLS。安全に通信を行うためのプロトコル
    - JSON WEB Token
      クライアント側で内容の確認/編集が簡単にできるため、サーバー側の検証が不十分だと改竄された情報を正規として受け入れてしまう
      - 対策
        - ヘッダーのアルゴリズムに"none"以外を指定して著名を暗号化する
        - ペイロードのオーディエンスに想定する利用者を指定して受信時に検証する

## 次やること
- フルスタックエンジニアが教える 即戦力Railsエンジニア養成講座

## 感じたこと
- RESTの6つの設計原則の概念やメリットを学ぶことができたので、今後は実際にREST APIがどのように作られて動作をするのかを理解していきたい。
  
## 学習時間
- 今日：4h
- 累計：431h
